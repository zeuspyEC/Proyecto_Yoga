<!DOCTYPE html>
<html lang=\"es\">
<head>
    <meta charset=\"UTF-8\">
    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">
    <meta name=\"theme-color\" content=\"#6B46C1\">
    <title>Setup Demo - SoftZen</title>
    <link rel=\"stylesheet\" href=\"styles.css\">
    <style>
        /* Estilos espec√≠ficos para setup */
        .setup-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: var(--spacing-xl);
        }
        
        .setup-card {
            max-width: 900px;
            margin: 0 auto;
            background: var(--surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            padding: var(--spacing-2xl);
        }
        
        .setup-header {
            text-align: center;
            margin-bottom: var(--spacing-2xl);
        }
        
        .setup-header h1 {
            color: var(--primary-color);
            margin-bottom: var(--spacing-md);
        }
        
        .setup-section {
            background: var(--background);
            padding: var(--spacing-xl);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-xl);
        }
        
        .setup-section h2 {
            color: var(--text-dark);
            margin-bottom: var(--spacing-md);
        }
        
        .setup-status {
            background: var(--surface);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin-top: var(--spacing-md);
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.875rem;
        }
        
        .status-message {
            padding: var(--spacing-xs) 0;
        }
        
        .status-success {
            color: var(--success-color);
        }
        
        .status-error {
            color: var(--error-color);
        }
        
        .status-warning {
            color: var(--warning-color);
        }
        
        .status-info {
            color: var(--info-color);
        }
        
        .demo-credentials {
            background: white;
            padding: var(--spacing-lg);
            border-radius: var(--radius-md);
            margin-top: var(--spacing-lg);
        }
        
        .credential-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
            margin-top: var(--spacing-md);
        }
        
        .credential-card {
            background: var(--background);
            padding: var(--spacing-md);
            border-radius: var(--radius-sm);
        }
        
        .credential-card h4 {
            color: var(--primary-color);
            margin-bottom: var(--spacing-sm);
        }
        
        .setup-actions {
            display: flex;
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
        }
        
        .progress-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-2xl);
            padding: 0 var(--spacing-xl);
        }
        
        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            flex: 1;
        }
        
        .progress-step::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 50%;
            right: -50%;
            height: 2px;
            background: var(--border-color);
            z-index: -1;
        }
        
        .progress-step:last-child::before {
            display: none;
        }
        
        .progress-step.completed .step-circle {
            background: var(--success-color);
            color: white;
        }
        
        .progress-step.completed::before {
            background: var(--success-color);
        }
        
        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--border-color);
            color: var(--text-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }
        
        .step-label {
            font-size: 0.875rem;
            color: var(--text-light);
            text-align: center;
        }
    </style>
</head>
<body>
    <div class=\"setup-container\">
        <div class=\"setup-card\">
            <div class=\"setup-header\">
                <div class=\"logo\">üßò‚Äç‚ôÄÔ∏è</div>
                <h1>SoftZen - Configuraci√≥n Demo</h1>
                <p>Configura los datos de demostraci√≥n para comenzar a usar SoftZen</p>
            </div>
            
            <div class=\"progress-indicator\">
                <div class=\"progress-step\" id=\"step1\">
                    <span class=\"step-circle\">1</span>
                    <span class=\"step-label\">Firebase</span>
                </div>
                <div class=\"progress-step\" id=\"step2\">
                    <span class=\"step-circle\">2</span>
                    <span class=\"step-label\">Usuarios</span>
                </div>
                <div class=\"progress-step\" id=\"step3\">
                    <span class=\"step-circle\">3</span>
                    <span class=\"step-label\">Terapias</span>
                </div>
                <div class=\"progress-step\" id=\"step4\">
                    <span class=\"step-circle\">4</span>
                    <span class=\"step-label\">Completado</span>
                </div>
            </div>
            
            <div class=\"setup-section\">
                <h2>üî• Estado de Firebase</h2>
                <p>Verificando la conexi√≥n con Firebase...</p>
                <button class=\"btn-primary\" id=\"checkFirebase\">Verificar Firebase</button>
                <div id=\"firebaseStatus\" class=\"setup-status\"></div>
            </div>
            
            <div class=\"setup-section\">
                <h2>üë• Crear Usuarios Demo</h2>
                <p>Se crear√°n usuarios de demostraci√≥n para probar la aplicaci√≥n:</p>
                
                <div class=\"demo-credentials\">
                    <h3>Credenciales que se crear√°n:</h3>
                    <div class=\"credential-grid\">
                        <div class=\"credential-card\">
                            <h4>üë®‚Äç‚öïÔ∏è Instructor</h4>
                            <p><strong>Nombre:</strong> Dr. Carlos Mendoza</p>
                            <p><strong>Email:</strong> admin@softzen.com</p>
                            <p><strong>Contrase√±a:</strong> SoftZen2024</p>
                            <p><strong>Especialidad:</strong> Yoga Terap√©utico</p>
                        </div>
                        <div class=\"credential-card\">
                            <h4>üßò‚Äç‚ôÄÔ∏è Paciente 1</h4>
                            <p><strong>Nombre:</strong> Mar√≠a Garc√≠a</p>
                            <p><strong>Email:</strong> paciente@softzen.com</p>
                            <p><strong>Contrase√±a:</strong> SoftZen2024</p>
                            <p><strong>Condici√≥n:</strong> Dolor de espalda</p>
                        </div>
                        <div class=\"credential-card\">
                            <h4>üßò‚Äç‚ôÇÔ∏è Paciente 2</h4>
                            <p><strong>Nombre:</strong> Juan P√©rez</p>
                            <p><strong>Email:</strong> paciente2@softzen.com</p>
                            <p><strong>Contrase√±a:</strong> SoftZen2024</p>
                            <p><strong>Condici√≥n:</strong> Ansiedad</p>
                        </div>
                        <div class=\"credential-card\">
                            <h4>üßò Paciente 3</h4>
                            <p><strong>Nombre:</strong> Ana Rodr√≠guez</p>
                            <p><strong>Email:</strong> paciente3@softzen.com</p>
                            <p><strong>Contrase√±a:</strong> SoftZen2024</p>
                            <p><strong>Condici√≥n:</strong> Artritis</p>
                        </div>
                    </div>
                </div>
                
                <div class=\"setup-actions\">
                    <button class=\"btn-primary\" id=\"setupAllDemo\" disabled>
                        üöÄ Configurar Todo Autom√°ticamente
                    </button>
                    <button class=\"btn-secondary\" id=\"setupManual\" disabled>
                        ‚öôÔ∏è Configuraci√≥n Manual
                    </button>
                </div>
                <div id=\"setupStatus\" class=\"setup-status\"></div>
            </div>
            
            <div class=\"setup-section\">
                <h2>‚úÖ Verificaci√≥n Final</h2>
                <p>Comprueba que todo est√© funcionando correctamente:</p>
                <button class=\"btn-primary\" id=\"verifySetup\" disabled>Verificar Instalaci√≥n</button>
                <div id=\"verifyStatus\" class=\"setup-status\"></div>
                
                <div class=\"setup-actions\" style=\"margin-top: 2rem;\">
                    <button class=\"btn-primary btn-large\" onclick=\"window.location.href='/'\" disabled id=\"goToApp\">
                        üßò‚Äç‚ôÄÔ∏è Ir a SoftZen
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src=\"https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js\"></script>
    <script src=\"https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js\"></script>
    <script src=\"https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js\"></script>
    <script src=\"https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js\"></script>
    
    <!-- Scripts de la aplicaci√≥n -->
    <script src=\"js/firebase-config.js\"></script>
    <script src=\"js/firebase-service.js\"></script>
    <script src=\"js/therapyData.js\"></script>
    <script src=\"js/notifications.js\"></script>
    <script src=\"js/setup-demo.js\"></script>
    
    <script>
        // Estado del setup
        let setupState = {
            firebase: false,
            users: false,
            therapies: false,
            verified: false
        };
        
        // Funci√≥n para actualizar el progreso visual
        function updateProgress() {
            if (setupState.firebase) document.getElementById('step1').classList.add('completed');
            if (setupState.users) document.getElementById('step2').classList.add('completed');
            if (setupState.therapies) document.getElementById('step3').classList.add('completed');
            if (setupState.verified) document.getElementById('step4').classList.add('completed');
        }
        
        // Funci√≥n para log en el UI
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const time = new Date().toLocaleTimeString();
            const className = `status-${type}`;
            element.innerHTML += `<div class=\"status-message ${className}\">[${time}] ${message}</div>`;
            element.scrollTop = element.scrollHeight;
        }
        
        // Verificar Firebase
        document.getElementById('checkFirebase').addEventListener('click', async () => {
            const btn = document.getElementById('checkFirebase');
            btn.disabled = true;
            
            log('firebaseStatus', 'Verificando conexi√≥n con Firebase...', 'info');
            
            // Esperar a que Firebase est√© listo
            let attempts = 0;
            const maxAttempts = 30;
            
            const checkInterval = setInterval(() => {
                attempts++;
                
                if (window.firebaseServices && window.firebaseServices.isInitialized()) {
                    clearInterval(checkInterval);
                    log('firebaseStatus', '‚úÖ Firebase inicializado correctamente', 'success');
                    log('firebaseStatus', '‚úÖ Firebase Auth disponible', 'success');
                    log('firebaseStatus', '‚úÖ Firebase Firestore disponible', 'success');
                    log('firebaseStatus', '‚úÖ Firebase Storage disponible', 'success');
                    
                    setupState.firebase = true;
                    updateProgress();
                    
                    // Habilitar botones de setup
                    document.getElementById('setupAllDemo').disabled = false;
                    document.getElementById('setupManual').disabled = false;
                    
                    showSuccess('Firebase verificado correctamente');
                } else if (attempts >= maxAttempts) {
                    clearInterval(checkInterval);
                    log('firebaseStatus', '‚ùå No se pudo inicializar Firebase', 'error');
                    showError('Error al conectar con Firebase');
                }
            }, 100);
        });
        
        // Setup autom√°tico completo
        document.getElementById('setupAllDemo').addEventListener('click', async () => {
            const btn = document.getElementById('setupAllDemo');
            btn.disabled = true;
            
            log('setupStatus', 'üöÄ Iniciando configuraci√≥n autom√°tica...', 'info');
            
            try {
                // Usar la funci√≥n del m√≥dulo setup-demo.js
                await window.setupDemoData();
                
                setupState.users = true;
                setupState.therapies = true;
                updateProgress();
                
                log('setupStatus', '‚úÖ Configuraci√≥n completada exitosamente', 'success');
                
                // Habilitar verificaci√≥n
                document.getElementById('verifySetup').disabled = false;
                
                // Auto-verificar
                setTimeout(() => {
                    document.getElementById('verifySetup').click();
                }, 1000);
                
            } catch (error) {
                log('setupStatus', `‚ùå Error: ${error.message}`, 'error');
                showError('Error durante la configuraci√≥n');
            }
            
            btn.disabled = false;
        });
        
        // Verificar setup
        document.getElementById('verifySetup').addEventListener('click', async () => {
            const btn = document.getElementById('verifySetup');
            btn.disabled = true;
            
            log('verifyStatus', 'üîç Verificando instalaci√≥n...', 'info');
            
            try {
                // Verificar usuarios
                const usersSnapshot = await firebase.firestore().collection('users').get();
                log('verifyStatus', `‚úÖ ${usersSnapshot.size} usuarios encontrados`, 'success');
                
                // Verificar terapias
                const therapiesSnapshot = await firebase.firestore().collection('therapies').get();
                log('verifyStatus', `‚úÖ ${therapiesSnapshot.size} series de terapia encontradas`, 'success');
                
                // Verificar sesiones
                const sessionsSnapshot = await firebase.firestore().collection('sessions').get();
                log('verifyStatus', `‚úÖ ${sessionsSnapshot.size} sesiones de ejemplo encontradas`, 'success');
                
                // Verificar que hay al menos un instructor y un paciente
                let hasInstructor = false;
                let hasPatient = false;
                
                usersSnapshot.forEach(doc => {
                    const userData = doc.data();
                    if (userData.userType === 'instructor') hasInstructor = true;
                    if (userData.userType === 'patient') hasPatient = true;
                });
                
                if (hasInstructor && hasPatient) {
                    log('verifyStatus', '‚úÖ Usuarios demo verificados correctamente', 'success');
                    log('verifyStatus', 'üéâ ¬°Setup completado exitosamente!', 'success');
                    
                    setupState.verified = true;
                    updateProgress();
                    
                    // Habilitar bot√≥n para ir a la app
                    document.getElementById('goToApp').disabled = false;
                    
                    showSuccess('¬°Configuraci√≥n completada! Ya puedes usar SoftZen');
                } else {
                    log('verifyStatus', '‚ö†Ô∏è Faltan algunos usuarios demo', 'warning');
                }
                
            } catch (error) {
                log('verifyStatus', `‚ùå Error verificando: ${error.message}`, 'error');
                showError('Error durante la verificaci√≥n');
            }
            
            btn.disabled = false;
        });
        
        // Auto-verificar Firebase al cargar
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('checkFirebase').click();
            }, 1000);
        });
        
        // Setup manual (opcional)
        document.getElementById('setupManual').addEventListener('click', () => {
            showInfo('La configuraci√≥n manual estar√° disponible pr√≥ximamente');
        });
    </script>
</body>
</html>